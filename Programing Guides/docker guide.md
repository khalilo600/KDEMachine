# Docker Guide: Comprehensive Learning Outline

This guide provides a structured overview of Docker, an open-source platform for developing, shipping, and running applications inside containers. It covers core concepts, Docker Images, Containers, Volumes, Networks, Docker Compose for multi-container applications, Docker Registry, advanced topics, and best practices for containerization.

---

## I. Getting Started and Core Concepts

### A. What is Docker?

Docker is a platform that uses OS-level virtualization to deliver software in packages called containers. Containers are isolated from one another and bundle their own software, libraries, and configuration files; they can communicate with each other through well-defined channels.

*   **Containerization:** A lightweight, portable, and efficient way to package and run applications.
*   **OS-level Virtualization:** Containers share the host OS kernel, making them much lighter than traditional VMs.
*   **Standardized:** Provides a consistent environment from development to production.

### B. Why Use Docker?

*   **Consistency:** Ensures that your application runs the same way regardless of the environment (development, testing, production).
*   **Isolation:** Applications and their dependencies are isolated from each other and from the host system.
*   **Portability:** Containers can be easily moved between different environments.
*   **Efficiency:** Containers are lightweight and start quickly, making efficient use of system resources.
*   **Scalability:** Easier to scale applications by deploying more containers.
*   **CI/CD Integration:** Seamlessly integrates into Continuous Integration/Continuous Deployment pipelines.

### C. Installation and Setup (Docker Desktop, Docker Engine)

1.  **Docker Desktop:** For Windows and macOS, provides a complete Docker development environment including Docker Engine, Docker CLI, Docker Compose, Kubernetes, and more. Download from [docker.com/products/docker-desktop](https://www.docker.com/products/docker-desktop).
2.  **Docker Engine:** For Linux servers, the core Docker runtime. Install via your distribution's package manager or Docker's official instructions.

    ```bash
    # Verify Docker installation in terminal
    docker --version
    docker compose version # For Docker Compose V2
    ```

### D. Basic Terminology (Image, Container, Dockerfile, Registry, Volume, Network)

*   **Image:** A lightweight, standalone, executable package that includes everything needed to run a piece of software, including the code, a runtime, libraries, environment variables, and config files. (Blueprint for containers).
*   **Container:** A runnable instance of an image. (Running instance of the blueprint).
*   **Dockerfile:** A text file that contains all the commands a user could call on the command line to assemble an image.
*   **Registry:** A service that stores Docker images (e.g., Docker Hub).
*   **Volume:** A mechanism for persisting data generated by and used by Docker containers.
*   **Network:** Allows containers to communicate with each other and with the host.

### E. Docker Architecture (Client, Daemon, Registry)

*   **Docker Client:** The `docker` command-line tool that allows users to interact with Docker.
*   **Docker Daemon (dockerd):** The background service that runs on the host machine. It builds, runs, and manages Docker images, containers, networks, and volumes.
*   **Docker Registry:** Stores Docker images. Docker Hub is the default public registry.

---

## II. Docker Images

### A. Pulling Images (`docker pull`)

Downloads an image from a registry (defaulting to Docker Hub).

```bash
docker pull ubuntu:latest
docker pull nginx:1.23
```

### B. Building Images (`docker build`)

Creates a Docker image from a Dockerfile.

```bash
# In the directory containing your Dockerfile
docker build -t my-web-app:1.0 . # -t tags the image, '.' specifies build context
```

*   **Dockerfile Syntax (FROM, RUN, COPY, ADD, WORKDIR, EXPOSE, CMD, ENTRYPOINT)

    ```dockerfile
    # Dockerfile
    # FROM: Base image
    FROM ubuntu:22.04

    # LABEL: Metadata for the image
    LABEL maintainer="your_email@example.com"

    # ENV: Set environment variables
    ENV MY_VAR="hello"

    # WORKDIR: Set the working directory for subsequent instructions
    WORKDIR /app

    # COPY: Copy files/directories from host to image
    COPY . /app

    # RUN: Execute commands during image build
    RUN apt-get update && apt-get install -y python3 python3-pip && \
        pip3 install Flask

    # EXPOSE: Inform Docker that the container listens on the specified network ports at runtime
    EXPOSE 5000

    # CMD: Default command to execute when a container starts (can be overridden)
    CMD ["python3", "app.py"]

    # ENTRYPOINT: Configures a container that will run as an executable
    # ENTRYPOINT ["/app/entrypoint.sh"]
    ```

*   **Best Practices for Dockerfiles:**
    *   Use small base images (e.g., `alpine`, `slim`).
    *   Use multi-stage builds to reduce image size.
    *   Cache layers effectively (order `RUN` commands from least to most frequently changing).
    *   Avoid installing unnecessary packages.
    *   Use `.dockerignore` to exclude unnecessary files.

### C. Listing Images (`docker images`)

Shows all local Docker images.

```bash
docker images
```

### D. Removing Images (`docker rmi`)

Deletes one or more Docker images.

```bash
docker rmi my-web-app:1.0
docker rmi <image_id>
```

---

## III. Docker Containers

### A. Running Containers (`docker run`)

Creates and starts a new container from an image.

```bash
# Run a simple Ubuntu container interactively
docker run -it ubuntu:latest bash

# Run a web app container in detached mode, mapping ports
docker run -d -p 80:5000 my-web-app:1.0 # Maps host port 80 to container port 5000
```

*   **Detached Mode (`-d`):** Runs the container in the background.
*   **Port Mapping (`-p`):** Maps a host port to a container port.
*   **Volume Mounting (`-v`):** Mounts a host path or a named volume into the container.
*   **Environment Variables (`-e`):** Sets environment variables inside the container.

    ```bash
    docker run -d -p 8080:80 -v /path/on/host:/app/data -e DB_HOST=mydb --name my-running-app my-web-app:1.0
    ```

### B. Listing Containers (`docker ps`)

Shows running containers. Use `-a` to show all containers (running and stopped).

```bash
docker ps
docker ps -a
```

### C. Stopping and Starting Containers (`docker stop`, `docker start`)

```bash
docker stop <container_id_or_name>
docker start <container_id_or_name>
```

### D. Removing Containers (`docker rm`)

Deletes one or more containers. Use `-f` to force removal of a running container.

```bash
docker rm my-running-app
docker rm -f <container_id>
```

### E. Executing Commands in Containers (`docker exec`)

Runs a command inside a running container.

```bash
docker exec -it my-running-app bash # Open a bash shell inside the container
docker exec my-running-app ls /app
```

### F. Viewing Container Logs (`docker logs`)

Retrieves logs from a container.

```bash
docker logs my-running-app
docker logs -f my-running-app # Follow logs in real-time
```

---

## IV. Docker Volumes and Networks

### A. Volumes

Used to persist data generated by and used by Docker containers.

*   **Named Volumes (`docker volume create`):** Managed by Docker, stored in a Docker-managed part of the host filesystem. Recommended for most use cases.

    ```bash
    docker volume create my-data
docker run -d -v my-data:/app/data --name my-app-with-volume my-web-app:1.0
    ```

*   **Bind Mounts:** Mounts a file or directory from the host machine into a container. Useful for development (e.g., live code changes).

    ```bash
docker run -d -v /path/to/local/code:/app --name my-dev-app my-web-app:1.0
    ```

*   **Using Volumes in Dockerfiles and `docker run`:**
    *   `VOLUME` instruction in Dockerfile creates a mount point with a specified name or as an anonymous volume.
    *   `-v` flag in `docker run` mounts volumes.

### B. Networks

Allows containers to communicate with each other and with the host.

*   **Bridge Networks (default):** Containers on the same bridge network can communicate by IP address.
*   **Custom Bridge Networks (`docker network create`):** Recommended for user-defined networks, allowing containers to communicate by name.

    ```bash
docker network create my-app-network
docker run -d --network my-app-network --name web my-web-app:1.0
docker run -d --network my-app-network --name db postgres:latest
# 'web' container can now access 'db' container by hostname 'db'
    ```

*   **Host Network:** Container shares the host's network stack.
*   **None Network:** Container is isolated from all networks.
*   **Connecting Containers to Networks:** Use the `--network` flag with `docker run`.

---

## V. Docker Compose

### A. What is Docker Compose?

A tool for defining and running multi-container Docker applications. You define your application's services, networks, and volumes in a `docker-compose.yml` file, then use a single command to bring up the entire application stack.

### B. `docker-compose.yml` Syntax (services, networks, volumes)

```yaml
# docker-compose.yml
version: '3.8' # Specify Compose file format version

services:
  web: # Service name
    build: . # Build image from Dockerfile in current directory
    ports:
      - "80:5000" # Host_port:Container_port
    volumes:
      - .:/app # Bind mount for development
    environment:
      - FLASK_ENV=development
    depends_on: # Define dependency on other services
      - db
    networks:
      - app-network

  db: # Database service
    image: postgres:13 # Use a pre-built image
    environment:
      - POSTGRES_DB=mydb
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - db-data:/var/lib/postgresql/data # Named volume for persistence
    networks:
      - app-network

volumes: # Define named volumes
  db-data:

networks: # Define custom networks
  app-network:
    driver: bridge
```

### C. Building and Running Multi-Container Applications (`docker compose up`)

```bash
docker compose up -d --build # Build images (if needed) and run services in detached mode
```

### D. Stopping and Removing (`docker compose down`)

```bash
docker compose down # Stop and remove containers, networks, and default volumes
docker compose down --volumes # Also remove named volumes
```

### E. Scaling Services

```bash
docker compose up --scale web=3 # Scale the 'web' service to 3 instances
```

---

## VI. Docker Registry

### A. Docker Hub

The default public registry for Docker images.

### B. Pushing Images (`docker push`)

Uploads a local image to a registry. You need to tag your image with your registry username.

```bash
docker tag my-web-app:1.0 your_dockerhub_username/my-web-app:1.0
docker push your_dockerhub_username/my-web-app:1.0
```

### C. Pulling Images (`docker pull`)

Downloads an image from a registry.

```bash
docker pull your_dockerhub_username/my-web-app:1.0
```

### D. Private Registries

You can use private registries (e.g., AWS ECR, Google Container Registry, Azure Container Registry) to store your images securely.

---

## VII. Advanced Topics

### A. Multi-Stage Builds

Optimize Dockerfiles for smaller, more secure images by using multiple `FROM` statements.

```dockerfile
# Dockerfile (Multi-stage build example)
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### B. Docker Swarm (Orchestration)

A native Docker tool for orchestrating a cluster of Docker Engines. (Kubernetes is generally preferred for larger-scale orchestration).

### C. Docker Security (Secrets, Content Trust)

*   **Docker Secrets:** Manage sensitive data (passwords, API keys) for Swarm services.
*   **Docker Content Trust:** Verify the integrity and publisher of images.

### D. Docker Events

View real-time events from the Docker daemon.

```bash
docker events
```

---

## VIII. Best Practices and Tools

### A. Containerization Best Practices

*   **One Process Per Container:** Each container should ideally run a single concern.
*   **Stateless Containers:** Design containers to be stateless; persist data in volumes.
*   **Minimize Image Size:** Use multi-stage builds, small base images, and `.dockerignore`.
*   **Security:** Run containers as non-root users, scan images for vulnerabilities.

### B. Optimizing Image Size

(See Multi-Stage Builds and Best Practices for Dockerfiles)

### C. Monitoring Containers

Use Docker's built-in `docker stats` or external monitoring tools (Prometheus, Grafana).

```bash
docker stats
```

### D. Version Control (Git)

Store your Dockerfiles and `docker-compose.yml` files in Git for version control.
